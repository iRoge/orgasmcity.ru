(function(){window.GoogleMapView=function(){GoogleMapView.options={markersImage:"/local/templates/respect/images/map-marker.png",default:{center:{lat:55.7494733,lng:37.35232},scrollwheel:false,zoom:8}};function GoogleMapView(wrapper,options){var bounds,i,item,len,marker,page,ref;if(options==null){options={}}this.options=_.extend(GoogleMapView.options,options);this._markers={};this._mapOptions=this.options.google?_.extend(this.options["default"],this.options.google):this.options["default"];this._map=new google.maps.Map(wrapper[0],this._mapOptions);bounds=new google.maps.LatLngBounds;ref=this.options.items;for(i=0,len=ref.length;i<len;i++){item=ref[i];marker=new google.maps.Marker({map:this._map,position:item.coordinates,title:item.title,icon:this._markerImage(),zIndex:item.index});bounds.extend(item.coordinates);marker.data=item;page=this;marker.addListener("click",function(a,b,c){return page._showInfoWindow(this)});this._markers[item.index]=marker}if(!$.isEmptyObject(this._markers)){this._map.fitBounds(bounds)}else{this._map.setCenter(this._mapOptions.center)}if(this.options.items.length===1){setTimeout(function(_this){return function(){return _this._map.setZoom(_this._mapOptions.zoom)}}(this),500)}google.maps.event.addListener(this._map,"click",function(_this){return function(){if(_this._infoWindow){return _this._infoWindow.close()}}}(this))}GoogleMapView.prototype.select=function(index){if(index){return this._showInfoWindow(this._markers[index])}};GoogleMapView.prototype._showInfoWindow=function(marker){if(this._infoWindow){this._infoWindow.close()}this._infoWindow=new google.maps.InfoWindow({content:this._infoWindowTemplate(marker.data),maxWidth:350,maxHeight:220});google.maps.event.addListener(this._infoWindow,"domready",function(){var iwBackground,iwCloseBtn,iwOuter;iwOuter=$(".gm-style-iw");iwOuter.css("width","auto");iwBackground=iwOuter.prev();$(iwBackground).addClass("bubble-background");iwBackground.children(":nth-child(1)").hide();iwBackground.children(":nth-child(2)").hide();iwBackground.children(":nth-child(3)").hide();iwBackground.children(":nth-child(4)").hide();iwCloseBtn=iwOuter.next();return iwCloseBtn.hide()});this._infoWindow.open(this._map,marker);if(_.isFunction(this.options.onSelect)){return this.options.onSelect(marker.zIndex)}};GoogleMapView.prototype._infoWindowTemplate=function(data){var template;template=_.template('<div class="map-bubble">\n  <div class="map-bubble__title"><%=title%></div>\n  <% if (subway) { %>\n  <div class="map-bubble__metro">\n    <i class="icon icon-metro"></i>\n    <%=subway%>\n  </div>\n  <% } %>\n  <div class="map-bubble__address"><%=address%></div>\n  <ul class="map-bubble__info">\n    <% if (worktime) { %>\n    <li>\n      <i class="icon icon-clock"></i>\n      <span><%=worktime%></span>\n    </li>\n    <% } %>\n    <% if (phone) { %>\n    <li>\n      <i class="icon icon-phone"></i>\n      <span><%=phone%></span>\n    </li>\n    <% } %>\n  </ul>\n</div>');return template(data)};GoogleMapView.prototype._markerImage=function(){return{url:this.options.markersImage,size:new google.maps.Size(47,61),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(23,61)}};return GoogleMapView}()}).call(this);