(function(){var isOverlapping;_.mixin({deepExtend:underscoreDeepExtend(_)});isOverlapping=function(first,second){var rect1,rect2;rect1=first.getBoundingClientRect();rect2=second.getBoundingClientRect();return!(rect1.right<rect2.left||rect1.left>rect2.right)};window.Filters=function(){var from,max,min,to;from=window.filterPriceFrom||0;to=window.filterPriceTo||15e3;min=window.filterPriceMin||0;max=window.filterPriceMax||15e3;Filters.options={cost:{start:[from,to],connect:true,tooltips:true,format:wNumb({decimals:0}),step:500,range:{min:min,max:max}}};function Filters(el,options){if(options==null){options={}}this._el=el;this.options=_.deepExtend(Filters.options,options);this._events();this._form();this._linkInputs()}Filters.prototype._events=function(){$(".js-filters-toggle").on("click",function(_this){return function(event){return _this.toggle()}}(this));$(".js-filters-reset").on("click",function(_this){return function(event){return _this.reset()}}(this));return $("body").on("click",function(_this){return function(event){if(!event.target.closest(".filters")){return _this.close()}}}(this))};Filters.prototype._form=function(){var range,slider;range=$(".range-selector",this._el)[0];slider=noUiSlider.create(range,this.options.cost);return slider.on("slide",function(_this){return function(){var tooltips;tooltips=$(".noUi-tooltip",range);return $(range).toggleClass("overlapping",isOverlapping(tooltips[0],tooltips[1]))}}(this))};Filters.prototype._linkInputs=function(){$("header select",this._el).on("change",function(_this){return function(event){var checkboxes,filtered,select,selector,targetSelector,values;select=$(event.currentTarget);selector=select.attr("id").split("-")[1];values=select.val();targetSelector=_.map(values,function(value){return"#"+select.attr("name")+"_"+value}).join(", ");checkboxes=$("#checkbox-"+selector+" input",_this._el);filtered=checkboxes.filter(targetSelector);checkboxes.prop("checked",false);return filtered.prop("checked",true)}}(this));$("footer .filters__linked input",this._el).on("change",function(_this){return function(event){var checkbox,checkedValues,selector,targetName,targetSelect,wrapper;checkbox=$(event.currentTarget);wrapper=checkbox.closest(".filters__linked");selector=wrapper.attr("id").split("-")[1];targetSelect=$("#select-"+selector);targetName=targetSelect.attr("name");checkedValues=_.map($("input:checked",wrapper),function(input){return $(input).attr("name").replace(targetName+"_","")});return targetSelect[0].selectize.setValue(checkedValues,true)}}(this));$(".range-selector",this._el)[0].noUiSlider.on("update",function(_this){return function(values,handle){$("input#cost_from",_this._el).val(values[0]);return $("input#cost_to",_this._el).val(values[1])}}(this));$(".js-f-stores input",this._el).off("change").on("change",function(_this){return function(event){var checkbox,checkedValue,targetInput,wrapper;checkbox=$(event.currentTarget);wrapper=checkbox.parent().parent().parent();if(!wrapper.find("input:checked").length){checkbox.prop("checked",true)}else{$('input[data-value="'+checkbox.attr("data-value")+'"]',this._el).prop("checked",checkbox.is(":checked"));currentValue=2==wrapper.find("input:checked").length?"A":wrapper.find("input:checked").attr("data-value");$("input#f_stores",_this._el)[0].value=currentValue;console.log(currentValue)}}}(this));return $("input#cost_from, input#cost_to",this._el).on("change",function(_this){return function(event){return $(".range-selector",_this._el)[0].noUiSlider.set([$("input#cost_from",_this._el).val(),$("input#cost_to",_this._el).val()])}}(this))};Filters.prototype.toggle=function(){return this._el.toggleClass("filters--expanded")};Filters.prototype.close=function(){return this._el.removeClass("filters--expanded")};Filters.prototype.reset=function(){$("form",this._el).each(function(index,form){return form.reset()});$("select.selectize",this._el).each(function(index,select){return select.selectize.clear()});return $(".range-selector",this._el)[0].noUiSlider.reset()};return Filters}()}).call(this);